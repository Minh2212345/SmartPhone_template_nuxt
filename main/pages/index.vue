<template>
  <div class="page-wrapper">
    <main class="main">
      <div class="container homepage-section mb-5">
        <div class="row">
          <!-- Cột trái: Danh mục -->
          <div class="col-lg-2 d-none d-lg-block">
            <div class="category-menu">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-mobile"></i> iPhone</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">iPhone 16 Series <span class="label-hot">HOT</span></h4>
                        <ul class="submenu-items">
                          <li><a href="#">iPhone 16</a></li>
                          <li><a href="#">iPhone 16e</a></li>
                          <li><a href="#">iPhone 16 Pro</a></li>
                          <li><a href="#">iPhone 16 Pro Max</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">iPhone 15 Series</h4>
                        <ul class="submenu-items">
                          <li><a href="#">iPhone 15</a></li>
                          <li><a href="#">iPhone 15 Plus</a></li>
                          <li><a href="#">iPhone 15 Pro</a></li>
                          <li><a href="#">iPhone 15 Pro Max</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">iPhone 14 Series</h4>
                        <ul class="submenu-items">
                          <li><a href="#">iPhone 14</a></li>
                          <li><a href="#">iPhone 14 Plus</a></li>
                          <li><a href="#">iPhone 14 Pro</a></li>
                          <li><a href="#">iPhone 14 Pro Max</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-laptop"></i> Samsung</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Galaxy S25 Ultra</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Galaxy S25 Ultra</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Galaxy A Series</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Galaxy A56</a></li>
                          <li><a href="#">Galaxy A36</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-headphones"></i> Xiaomi</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Xiaomi 15</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Xiaomi 15</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Redmi Series</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Redmi Note 14</a></li>
                          <li><a href="#">Redmi 14</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-camera"></i> Huawei</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Huawei Mate 60</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Huawei Mate 60</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Huawei P60</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Huawei P60</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Huawei Nova 10</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Huawei Nova 10</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-home"></i> Nothing Phone</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Nothing Phone 2A <span class="label-new">MỚI</span></h4>
                        <ul class="submenu-items">
                          <li><a href="#">Nothing Phone 2A</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Nothing Phone 2</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Nothing Phone 2</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-headphones"></i> OPPO</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">OPPO Find N5 <span class="label-new">MỚI</span></h4>
                        <ul class="submenu-items">
                          <li><a href="#">OPPO Find N5</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">OPPO Reno13</h4>
                        <ul class="submenu-items">
                          <li><a href="#">OPPO Reno13</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">OPPO A78</h4>
                        <ul class="submenu-items">
                          <li><a href="#">OPPO A78</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-desktop"></i> Redmi</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Redmi Note 14</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Redmi Note 14</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Redmi 13C</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Redmi 13C</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-tv"></i> Techno</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Techno Camon 30S</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Techno Camon 30S</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Techno Spark 20</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Techno Spark 20</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-tags"></i> Sony</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">Sony Xperia 1 VI</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Sony Xperia 1 VI</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">Sony Xperia 10 VI</h4>
                        <ul class="submenu-items">
                          <li><a href="#">Sony Xperia 10 VI</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link"><i class="las la-store"></i> OnePlus</a>
                  <ul class="submenu">
                    <div class="submenu-sections">
                      <li class="submenu-section">
                        <h4 class="submenu-title">OnePlus 12</h4>
                        <ul class="submenu-items">
                          <li><a href="#">OnePlus 12</a></li>
                        </ul>
                      </li>
                      <li class="submenu-section">
                        <h4 class="submenu-title">OnePlus Nord 4</h4>
                        <ul class="submenu-items">
                          <li><a href="#">OnePlus Nord 4</a></li>
                        </ul>
                      </li>
                    </div>
                  </ul>
                </li>
              </ul>
            </div>
          </div>

          <!-- Cột giữa: Slider chính -->
          <div class="col-lg-8">
            <div class="intro-slider-container">
              <div
                class="intro-slider owl-carousel owl-theme owl-nav-inside owl-light"
                data-toggle="owl"
                :data-owl-options="owlOptions"
              >
                <div class="intro-slide" style="background-image: url(assets/images/demos/demo-4/slider/slide-1.png)">
                  <div class="container intro-content">
                    <div class="row justify-content-end">
                      <div class="col-auto col-sm-7 col-md-6 col-lg-5">
                        <h3 class="intro-subtitle text-third">Sản phẩm mới</h3>
                        <h2 class="intro-title">Ipad Pro M4</h2>
                        <div class="intro-price">
                          <sup class="intro-old-price">36.590.000 VND</sup>
                          <br />
                          <span class="text-primary">36.224.000 VND</span>
                        </div>
                        <a href="category.html" class="btn btn-primary btn-round">
                          <span>Xem chi tiết</span>
                          <i class="icon-long-arrow-right"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="intro-slide" style="background-image: url(assets/images/demos/demo-4/slider/slide-2.png)">
                  <div class="container intro-content">
                    <div class="row justify-content-end">
                      <div class="col-auto col-sm-7 col-md-6 col-lg-5">
                        <h3 class="intro-subtitle text-primary">Sản phẩm mới</h3>
                        <h2 class="intro-title">BEATS SOLO 4</h2>
                        <div class="intro-price">
                          <span class="text-primary">3.299.000 VNĐ</span>
                        </div>
                        <a href="category.html" class="btn btn-primary btn-round">
                          <span>Xem chi tiết</span>
                          <i class="icon-long-arrow-right"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <span class="slider-loader"></span>
            </div>
          </div>

          <!-- Cột phải: Banner dọc -->
          <div class="col-lg-2">
            <div class="banner-right">
              <div class="banner-item mb-2">
                <a href="#">
                  <img src="assets/images/banners/banner-1.jpg" alt="Galaxy M55 5G" class="img-banner" />
                </a>
              </div>
              <div class="banner-item mb-2">
                <a href="#">
                  <img src="assets/images/banners/banner-2.jpg" alt="iPad Air" class="img-banner" />
                </a>
              </div>
              <div class="banner-item banner-item-last">
                <a href="#">
                  <img src="assets/images/banners/banner-3.jpg" alt="Banner 3" class="img-banner" />
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sản phẩm mới -->
      <div class="container new-arrivals mb-4">
        <div class="heading heading-flex mb-3">
          <div class="heading-left">
            <h2 class="title">Sản phẩm mới</h2>
          </div>
          <div class="heading-right">
            <ul class="nav nav-pills nav-border-anim justify-content-center" role="tablist">
              <li class="nav-item">
                <a
                  id="new-all-link"
                  class="nav-link active"
                  data-toggle="tab"
                  href="#new-all-tab"
                  role="tab"
                  aria-controls="new-all-tab"
                  aria-selected="true"
                  >All</a
                >
              </li>
              <li class="nav-item">
                <a
                  id="new-tv-link"
                  class="nav-link"
                  data-toggle="tab"
                  href="#new-tv-tab"
                  role="tab"
                  aria-controls="new-tv-tab"
                  aria-selected="false"
                  >iPhone</a
                >
              </li>
              <li class="nav-item">
                <a
                  id="new-computers-link"
                  class="nav-link"
                  data-toggle="tab"
                  href="#new-computers-tab"
                  role="tab"
                  aria-controls="new-computers-tab"
                  aria-selected="false"
                  >Samsung</a
                >
              </li>
              <li class="nav-item">
                <a
                  id="new-phones-link"
                  class="nav-link"
                  data-toggle="tab"
                  href="#new-phones-tab"
                  role="tab"
                  aria-controls="new-phones-tab"
                  aria-selected="false"
                  >OPPO</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div class="tab-content tab-content-carousel just-action-icons-sm">
          <div id="new-all-tab" class="tab-pane p-0 fade show active" role="tabpanel" aria-labelledby="new-all-link">
            <div
              class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow"
              data-toggle="owl"
              data-owl-options='{
                "nav": false,
                "dots": true,
                "margin": 20,
                "loop": false,
                "responsive": {
                  "0": { "items": 1 },
                  "480": { "items": 2 },
                  "768": { "items": 3 },
                  "992": { "items": 4 },
                  "1200": { "items": 4, "nav": true, "dots": false }
                }
              }'
            >
              <div v-for="product in newProducts" :key="product.id" class="product product-7 text-center">
                <figure class="product-media">
                  <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                  <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                    <img
                      :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                      alt="Product image"
                      class="product-image"
                    />
                  </NuxtLink>
                  <div class="product-action-vertical">
                    <NuxtLink to="/compare-page" class="btn-product-icon btn-compare" title="Compare">
                      <span>So sánh</span>
                    </NuxtLink>
                  </div>
                </figure>
                <div class="product-body">
                  <div class="product-cat">
                    <a href="#">{{ manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown' }}</a>
                  </div>
                  <h3 class="product-title">
                    <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                  </h3>
                  <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                </div>
              </div>
            </div>
          </div>
          <div id="new-tv-tab" class="tab-pane p-0 fade" role="tabpanel" aria-labelledby="new-tv-link">
            <div
              class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow"
              data-toggle="owl"
              data-owl-options='{
                "nav": false,
                "dots": true,
                "margin": 20,
                "loop": false,
                "responsive": {
                  "0": { "items": 1 },
                  "480": { "items": 2 },
                  "768": { "items": 3 },
                  "992": { "items": 4 },
                  "1200": { "items": 4, "nav": true, "dots": false }
                }
              }'
            >
              <div v-for="product in iPhoneProducts" :key="product.id" class="product product-7 text-center">
                <figure class="product-media">
                  <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                  <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                    <img
                      :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                      alt="Product image"
                      class="product-image"
                    />
                  </NuxtLink>
                  <div class="product-action-vertical">
                    <NuxtLink to="/compare-page" class="btn-product-icon btn-compare" title="Compare">
                      <span>So sánh</span>
                    </NuxtLink>
                  </div>
                </figure>
                <div class="product-body">
                  <div class="product-cat">
                    <a href="#">{{ manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown' }}</a>
                  </div>
                  <h3 class="product-title">
                    <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                  </h3>
                  <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                </div>
              </div>
            </div>
          </div>
          <div id="new-computers-tab" class="tab-pane p-0 fade" role="tabpanel" aria-labelledby="new-computers-link">
            <div
              class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow"
              data-toggle="owl"
              data-owl-options='{
                "nav": false,
                "dots": true,
                "margin": 20,
                "loop": false,
                "responsive": {
                  "0": { "items": 1 },
                  "480": { "items": 2 },
                  "768": { "items": 3 },
                  "992": { "items": 4 },
                  "1200": { "items": 4, "nav": true, "dots": false }
                }
              }'
            >
              <div v-for="product in samsungProducts" :key="product.id" class="product product-7 text-center">
                <figure class="product-media">
                  <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                  <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                    <img
                      :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                      alt="Product image"
                      class="product-image"
                    />
                  </NuxtLink>
                  <div class="product-action-vertical">
                    <NuxtLink to="/compare-page" class="btn-product-icon btn-compare" title="Compare">
                      <span>So sánh</span>
                    </NuxtLink>
                  </div>
                </figure>
                <div class="product-body">
                  <div class="product-cat">
                    <a href="#">{{ manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown' }}</a>
                  </div>
                  <h3 class="product-title">
                    <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                  </h3>
                  <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                </div>
              </div>
            </div>
          </div>
          <div id="new-phones-tab" class="tab-pane p-0 fade" role="tabpanel" aria-labelledby="new-phones-link">
            <div
              class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow"
              data-toggle="owl"
              data-owl-options='{
                "nav": false,
                "dots": true,
                "margin": 20,
                "loop": false,
                "responsive": {
                  "0": { "items": 1 },
                  "480": { "items": 2 },
                  "768": { "items": 3 },
                  "992": { "items": 4 },
                  "1200": { "items": 4, "nav": true, "dots": false }
                }
              }'
            >
              <div v-for="product in oppoProducts" :key="product.id" class="product product-7 text-center">
                <figure class="product-media">
                  <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                  <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                    <img
                      :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                      alt="Product image"
                      class="product-image"
                    />
                  </NuxtLink>
                  <div class="product-action-vertical">
                    <NuxtLink to="/compare-page" class="btn-product-icon btn-compare" title="Compare">
                      <span>So sánh</span>
                    </NuxtLink>
                  </div>
                </figure>
                <div class="product-body">
                  <div class="product-cat">
                    <a href="#">{{ manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown' }}</a>
                  </div>
                  <h3 class="product-title">
                    <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                  </h3>
                  <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container text-center">
        <hr class="mb-0" />
        <div
          class="owl-carousel mt-5 mb-5 owl-simple"
          data-toggle="owl"
          data-owl-options='{
            "nav": false,
            "dots": false,
            "margin": 30,
            "loop": false,
            "responsive": {
              "0": { "items": 2 },
              "420": { "items": 3 },
              "600": { "items": 4 },
              "900": { "items": 5 },
              "1024": { "items": 6 }
            }
          }'
        >
          <a href="#" class="brand">
            <img src="assets/images/brands/1.png" alt="Brand Name" />
          </a>
          <a href="#" class="brand">
            <img src="assets/images/brands/2.png" alt="Brand Name" />
          </a>
          <a href="#" class="brand">
            <img src="assets/images/brands/3.png" alt="Brand Name" />
          </a>
          <a href="#" class="brand">
            <img src="assets/images/brands/4.png" alt="Brand Name" />
          </a>
          <a href="#" class="brand">
            <img src="assets/images/brands/5.png" alt="Brand Name" />
          </a>
          <a href="#" class="brand">
            <img src="assets/images/brands/6.png" alt="Brand Name" />
          </a>
        </div>
      </div>

      <!-- Sản phẩm nổi bật -->
      <div class="bg-light pt-5 pb-6">
        <div class="container trending-products">
          <div class="heading heading-flex mb-3">
            <div class="heading-left">
              <h2 class="title">Sản phẩm nổi bật</h2>
            </div>
            <div class="heading-right">
              <ul class="nav nav-pills nav-border-anim justify-content-center" role="tablist">
                <li class="nav-item">
                  <a
                    id="trending-best-link"
                    class="nav-link active"
                    data-toggle="tab"
                    href="#trending-best-tab"
                    role="tab"
                    aria-controls="trending-best-tab"
                    aria-selected="true"
                    >Bán chạy</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    id="trending-sale-link"
                    class="nav-link"
                    data-toggle="tab"
                    href="#trending-sale-tab"
                    role="tab"
                    aria-controls="trending-sale-tab"
                    aria-selected="false"
                    >Đang giảm giá</a
                  >
                </li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-5col d-none d-xl-block">
              <div class="banner">
                <a href="#" style="background-color: #000000">
                  <img src="assets/images/demos/demo-4/banners/banner-4.png" style="max-width: 90%" alt="banner" />
                </a>
              </div>
            </div>
            <div class="col-xl-4-5col">
              <div class="tab-content tab-content-carousel just-action-icons-sm">
                <div
                  id="trending-best-tab"
                  class="tab-pane p-0 fade show active"
                  role="tabpanel"
                  aria-labelledby="trending-best-link"
                >
                  <div
                    class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow"
                    data-toggle="owl"
                    data-owl-options='{
                      "nav": false,
                      "dots": true,
                      "margin": 20,
                      "loop": false,
                      "responsive": {
                        "0": { "items": 1 },
                        "480": { "items": 2 },
                        "768": { "items": 3 },
                        "992": { "items": 4 },
                        "1200": { "items": 4, "nav": true, "dots": false }
                      }
                    }'
                  >
                    <div
                      v-for="product in trendingBestProducts"
                      :key="product.id"
                      class="product product-7 text-center"
                    >
                      <figure class="product-media">
                        <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                        <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                          <img
                            :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                            alt="Product image"
                            class="product-image"
                          />
                        </NuxtLink>
                        <div class="product-action-vertical">
                          <NuxtLink to="/compare-page" class="btn-product-icon btn-compare" title="Compare">
                            <span>So sánh</span>
                          </NuxtLink>
                        </div>
                      </figure>
                      <div class="product-body">
                        <div class="product-cat">
                          <a href="#">{{
                            manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown'
                          }}</a>
                        </div>
                        <h3 class="product-title">
                          <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                        </h3>
                        <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  id="trending-sale-tab"
                  class="tab-pane p-0 fade"
                  role="tabpanel"
                  aria-labelledby="trending-sale-link"
                >
                  <div
                    class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow"
                    data-toggle="owl"
                    data-owl-options='{
                      "nav": false,
                      "dots": true,
                      "margin": 20,
                      "loop": false,
                      "responsive": {
                        "0": { "items": 1 },
                        "480": { "items": 2 },
                        "768": { "items": 3 },
                        "992": { "items": 4 },
                        "1200": { "items": 4, "nav": true, "dots": false }
                      }
                    }'
                  >
                    <div
                      v-for="product in trendingSaleProducts"
                      :key="product.id"
                      class="product product-7 text-center"
                    >
                      <figure class="product-media">
                        <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                        <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                          <img
                            :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                            alt="Product image"
                            class="product-image"
                          />
                        </NuxtLink>
                        <div class="product-action-vertical">
                          <NuxtLink to="/compare-page" class="btn-product-icon btn-compare" title="Compare">
                            <span>So sánh</span>
                          </NuxtLink>
                        </div>
                      </figure>
                      <div class="product-body">
                        <div class="product-cat">
                          <a href="#">{{
                            manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown'
                          }}</a>
                        </div>
                        <h3 class="product-title">
                          <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                        </h3>
                        <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sản phẩm gợi ý -->
      <div class="container for-you mb-4">
        <div class="heading heading-flex mb-3">
          <div class="heading-left">
            <h2 class="title">Sản phẩm gợi ý</h2>
          </div>
          <div class="heading-right">
            <a href="category-4cols.html" class="title-link">Xem các sản phẩm</a>
            <i class="icon-long-arrow-right"></i>
          </div>
        </div>
        <div class="products">
          <div class="row justify-content-center">
            <div v-for="product in recommendedProducts" :key="product.id" class="col-6 col-md-4 col-lg-3">
              <div class="product product-2">
                <figure class="product-media">
                  <span v-if="isNewProduct(product)" class="product-label label-new">SP mới</span>
                  <NuxtLink :to="`/product-page?sp_id=${product.id}`">
                    <img
                      :src="product.imageUrl || '/assets/images/placeholder.jpg'"
                      alt="Product image"
                      class="product-image"
                    />
                  </NuxtLink>
                </figure>
                <div class="product-body">
                  <div class="product-cat">
                    <a href="#">{{ manufacturerMap[product.tenNhaSanXuat] || product.tenNhaSanXuat || 'Unknown' }}</a>
                  </div>
                  <h3 class="product-title">
                    <NuxtLink :to="`/product-page?sp_id=${product.id}`">{{ product.tenSanPham }}</NuxtLink>
                  </h3>
                  <div class="product-price">{{ formatPrice(product.giaBan || 0) }} VND</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <button id="scroll-top" title="Back to Top">
      <i class="icon-arrow-up"></i>
    </button>
  </div>
</template>

<script>
export default {
  name: 'IndexPage',
  data() {
    return {
      newProducts: [],
      iPhoneProducts: [],
      samsungProducts: [],
      oppoProducts: [],
      trendingBestProducts: [],
      trendingSaleProducts: [],
      recommendedProducts: [],
      manufacturerMap: {
        1: 'Apple',
        2: 'Samsung',
        3: 'Xiaomi',
        4: 'OPPO',
      },
      owlOptions: {
        nav: true,
        dots: true,
        margin: 20,
        loop: true,
        autoplay: true,
        autoplayTimeout: 5000,
        responsive: {
          0: { items: 1 },
          480: { items: 1 },
          768: { items: 1 },
          992: { items: 1 },
          1200: { items: 1 },
        },
      },
      newProductsOwlOptions: {
        nav: false,
        dots: true,
        margin: 20,
        loop: false,
        responsive: {
          0: { items: 1 },
          480: { items: 2 },
          768: { items: 3 },
          992: { items: 4 },
          1200: { items: 4, nav: true, dots: false },
        },
      },
      trendingProductsOwlOptions: {
        nav: false,
        dots: true,
        margin: 20,
        loop: false,
        responsive: {
          0: { items: 1 },
          480: { items: 2 },
          768: { items: 3 },
          992: { items: 4 },
          1200: { items: 4, nav: true, dots: false },
        },
      },
    }
  },
  async mounted() {
    await Promise.all([
      this.fetchNewProducts(null), // All products
      this.fetchNewProducts(1), // iPhone
      this.fetchNewProducts(2), // Samsung
      this.fetchNewProducts(4), // OPPO
      this.fetchBestProducts(),
      this.fetchSaleProducts(),
      this.fetchRecommendedProducts(),
    ])
    this.populateSections()
    this.$nextTick(() => {
      setTimeout(() => {
        this.initializeOwlCarousel()
      }, 100)
    })
  },
  methods: {
    async fetchNewProducts(idNhaSanXuat) {
      try {
        const response = await this.$axios.get('/api/show-new-product', {
          params: { idNhaSanXuat: idNhaSanXuat },
        })
        const mappedProducts = Array.isArray(response.data)
          ? response.data.map((product) => ({
              ...product,
              tenNhaSanXuat: this.manufacturerMap[product.tenNhaSanXuat] || 'Unknown',
            }))
          : []
        if (idNhaSanXuat === null) {
          this.newProducts = mappedProducts
        } else if (idNhaSanXuat === 1) {
          this.iPhoneProducts = mappedProducts
        } else if (idNhaSanXuat === 2) {
          this.samsungProducts = mappedProducts
        } else if (idNhaSanXuat === 4) {
          this.oppoProducts = mappedProducts
        }
      } catch (error) {
        console.error('Error fetching new products:', error.message, error.response?.status)
        if (idNhaSanXuat === null) this.newProducts = []
        else if (idNhaSanXuat === 1) this.iPhoneProducts = []
        else if (idNhaSanXuat === 2) this.samsungProducts = []
        else if (idNhaSanXuat === 4) this.oppoProducts = []
      }
    },
    async fetchBestProducts() {
      try {
        const response = await this.$axios.get('/api/show-best-product', {
          params: { sortBy: 'SALES' },
        })
        this.trendingBestProducts = Array.isArray(response.data)
          ? response.data.map((product) => ({
              ...product,
              tenNhaSanXuat: this.manufacturerMap[product.tenNhaSanXuat] || 'Unknown',
            }))
          : []
      } catch (error) {
        console.error('Error fetching best products:', error.message, error.response?.status)
        this.trendingBestProducts = []
      }
    },
    async fetchSaleProducts() {
      try {
        const response = await this.$axios.get('/api/show-best-product', {
          params: { sortBy: 'DISCOUNT' },
        })
        this.trendingSaleProducts = Array.isArray(response.data)
          ? response.data.map((product) => ({
              ...product,
              tenNhaSanXuat: this.manufacturerMap[product.tenNhaSanXuat] || 'Unknown',
            }))
          : []
      } catch (error) {
        console.error('Error fetching sale products:', error.message, error.response?.status)
        this.trendingSaleProducts = []
      }
    },
    async fetchRecommendedProducts() {
      try {
        const response = await this.$axios.get('/api/san-pham-with-variants')
        this.recommendedProducts = Array.isArray(response.data)
          ? response.data.map((product) => ({
              ...product,
              tenNhaSanXuat: this.manufacturerMap[product.tenNhaSanXuat] || 'Unknown',
            }))
          : []
      } catch (error) {
        console.error('Error fetching recommended products:', error.message, error.response?.status)
        this.recommendedProducts = []
      }
    },
    populateSections() {
      // No need to filter here since data is fetched separately for each tab
    },
    isNewProduct(product) {
      if (!product.createdAt) return false
      const createdAt = new Date(product.createdAt)
      const now = new Date()
      const diffInDays = (now - createdAt) / (1000 * 60 * 60 * 24)
      return diffInDays <= 30
    },
    formatPrice(price) {
      return price.toLocaleString('vi-VN')
    },
    initializeOwlCarousel() {
  if (process.client) {
    this.$nextTick(() => {
      const $ = window.jQuery;
      if ($ && $.fn && $.fn.owlCarousel) {
        const $introSlider = $('.intro-slider');
        if ($introSlider.length) {
          if ($introSlider.hasClass('owl-loaded')) {
            $introSlider.trigger('destroy.owl.carousel');
            $introSlider.removeClass('owl-loaded owl-drag');
            $introSlider.find('.owl-stage-outer').children().unwrap();
            $introSlider.find('.owl-nav, .owl-dots').remove();
          }
          $introSlider.owlCarousel(this.owlOptions);
        }
        // Khởi tạo các carousel khác nếu cần
        $('.owl-carousel').not('.intro-slider').each(function () {
          const $this = $(this);
          if ($this.hasClass('owl-loaded')) {
            $this.trigger('destroy.owl.carousel');
            $this.removeClass('owl-loaded owl-drag');
            $this.find('.owl-stage-outer').children().unwrap();
            $this.find('.owl-nav, .owl-dots').remove();
          }
          const options = $this.data('owl-options') || {};
          $this.owlCarousel(options);
        });
      } else {
        console.error('jQuery or Owl Carousel not loaded');
      }
    });
  }
},
  },
}
</script>

<!-- <style scoped>
.intro-slide {
  height: 400px; /* Đặt chiều cao cố định để tránh co giãn */
  background-size: cover;
  background-position: center;
  display: flex !important; /* Đảm bảo flex hiển thị đúng */
  align-items: center;
  justify-content: flex-end;
}

.intro-content {
  width: 100%;
  max-width: 500px; /* Giới hạn chiều rộng nội dung */
}

.intro-price {
  margin: 10px 0;
}

.btn-round {
  padding: 10px 20px;
  display: inline-block;
}
</style> -->
